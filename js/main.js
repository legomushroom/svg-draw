// Generated by CoffeeScript 1.6.2
(function() {
  require.config({
    paths: {
      jquery: 'lib/jquery-2.0.1',
      underscore: 'lib/lodash.underscore',
      hammer: 'lib/hammer',
      tween: 'lib/tween.min',
      two: 'lib/two',
      'path-finder': 'lib/pathfinding-browser',
      path: 'modules/path'
    },
    shim: {
      "two": {
        exports: "Two"
      }
    }
  });

  define('main', ['helpers', 'hammer', 'jquery', 'two', 'path', 'grid', 'path-finder'], function(helpers, hammer, $, Two, Path, Grid, PathFinder) {
    'use strict';
    var App;

    App = (function() {
      function App() {
        this.initVars();
        this.listenToTouches();
      }

      App.prototype.initVars = function() {
        this.two = new Two({
          fullscreen: true,
          autostart: true
        }).appendTo($('#js-main')[0]);
        this.$svgCanvas = $(this.two.renderer.domElement);
        this.helpers = helpers;
        this.paths = [];
        this.objects = [];
        this.gs = 16;
        this.grid = new Grid;
        this.settings = {
          isSmartPath: true
        };
        return this.debug = {
          isGrid: false
        };
      };

      App.prototype.listenToTouches = function() {
        var _this = this;

        this.currPath = null;
        hammer(this.$svgCanvas[0]).on('touch', function(e) {
          var coords;

          coords = helpers.getEventCoords(e);
          if (!_this.grid.isFreeCell(coords)) {
            _this.currPath = null;
            return;
          }
          _this.currPath = new Path({
            coords: _this.grid.getNearestCellCenter(coords)
          });
          return _this.paths.push(_this.currPath);
        });
        hammer(this.$svgCanvas[0]).on('release', function(e) {
          var _ref;

          return (_ref = _this.currPath) != null ? _ref.removeIfEmpty() : void 0;
        });
        return hammer(this.$svgCanvas[0]).on('drag', function(e) {
          var coords, _ref;

          coords = helpers.getEventCoords(e);
          if (_this.grid.isFreeCell(coords)) {
            return (_ref = _this.currPath) != null ? _ref.addPoint(coords) : void 0;
          }
        });
      };

      return App;

    })();
    return window.App = new App;
  });

}).call(this);
